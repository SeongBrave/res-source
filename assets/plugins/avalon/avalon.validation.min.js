!function(){function a(a){var b,c,d,e,f;if(/^\d{15}$/.test(a))return!0;if(/^\d{17}[0-9xX]$/.test(a)){for(b="1,0,x,9,8,7,6,5,4,3,2".split(","),c="7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2".split(","),d=a.toLowerCase().split(""),e=0,f=0;17>f;f++)e+=c[f]*d[f];return b[e%11]==d[17]}}function b(a){var b,c,d,e,f;return"string"==typeof a&&a&&(b=a.split("-"),3===b.length&&4===b[0].length)?(c=~~b[0],d=~~b[1]-1,e=~~b[2],f=new Date(c,d,e),f.getFullYear()===c&&f.getMonth()===d&&f.getDate()===e):!1}function g(a){var b,c,d,e,f;if(a.target)return a;b={};for(c in a)b[c]=a[c];return d=b.target=a.srcElement,0===a.type.indexOf("key")?b.which=null!=a.charCode?a.charCode:a.keyCode:/mouse|click/.test(a.type)&&(e=d.ownerDocument||document,f="BackCompat"===e.compatMode?e.body:e.documentElement,b.pageX=a.clientX+(f.scrollLeft>>0)-(f.clientLeft>>0),b.pageY=a.clientY+(f.scrollTop>>0)-(f.clientTop>>0),b.wheelDeltaY=b.wheelDelta,b.wheelDeltaX=0),b.timeStamp=new Date-0,b.originalEvent=a,b.preventDefault=function(){a.returnValue=!1},b.stopPropagation=function(){a.cancelBubble=!0},b}function j(){var a=this.data||{};return this.message.replace(i,function(b,c){return null==a[c]?"":a[c]})}var c,d,e,f,h,i;if(!avalon.duplexHooks)throw new Error("你的版本少于avalon1.3.7，不支持ms-duplex2.0，请使用avalon.validation.old.js");c=/^([A-Z0-9]+[_|\_|\.]?)*[A-Z0-9]+@([A-Z0-9]+[_|\_|\.]?)*[A-Z0-9]+\.[A-Z]{2,3}$/i,d=/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i,e=/^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i,f={cm:/^(?:0?1)((?:3[56789]|5[0124789]|7[0124789]|8[278])\d|34[0-8]|47\d)\d{7}$/,cu:/^(?:0?1)(?:3[012]|4[5]|5[356]|8[356]\d|349)\d{7}$/,ce:/^(?:0?1)(?:33|53|8[079])\d{8}$/,cn:/^(?:0?1)[3458]\d{9}$/},avalon.mix(avalon.duplexHooks,{trim:{get:function(a,b){return"password"!==b.element.type&&(a=String(a||"").trim()),a}},required:{message:"必须填写",get:function(a,b,c){return c(""!==a),a}},norequired:{message:"可以不写",get:function(a,b,c){return c(!0),a}},"int":{message:"必须是整数",get:function(a,b,c){return c(/^\-?\d+$/.test(a)),a}},phone:{message:"不合法",get:function(a,b,c){var e,d=!1;for(e in f)if(f[e].test(a)){d=!0;break}return c(d),a}},decimal:{message:"必须是小数",get:function(a,b,c){return c(/^\-?\d*\.?\d+$/.test(a)),a}},alpha:{message:"必须是字母",get:function(a,b,c){return c(/^[a-z]+$/i.test(a)),a}},alpha_numeric:{message:"必须为字母或数字",get:function(a,b,c){return c(/^[a-z0-9]+$/i.test(a)),a}},alpha_dash:{message:"必须为字母或数字及下划线等特殊字符",validate:function(a,b,c){return c(/^[a-z0-9_\-]+$/i.test(a)),a}},chs:{message:"必须是中文字符",get:function(a,b,c){return c(/^[\u4e00-\u9fa5]+$/.test(a)),a}},chs_numeric:{message:"必须是中文字符或数字及下划线等特殊字符",get:function(a,b,c){return c(/^[\\u4E00-\\u9FFF0-9_\-]+$/i.test(a)),a}},qq:{message:"必须从10000开始",get:function(a,b,c){return c(/^[1-9]\d{4,10}$/.test(a)),a}},id:{message:"格式错误",get:function(b,c,d){return d(a(b)),b}},ipv4:{message:"不正确",get:function(a,b,c){return c(d.test(a)),a}},ipv6:{message:"不正确",get:function(a,b,c){return c(e.test(a)),a}},email:{message:"格式错误",get:function(a,b,d){return d(c.test(a)),a}},url:{message:"格式错误",get:function(a,b,c){return c(/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/.test(a)),a}},repeat:{message:"输入不一致",get:function(a,b,c){var d=b.element.getAttribute("data-duplex-repeat")||"",e=avalon(document.getElementById(d)).val()||"";return c(a===e),a}},date:{message:"必须符合日期格式 YYYY-MM-DD",get:function(a,c,d){return d(b(a)),a}},passport:{message:"格式错误或过长",get:function(a,b,c){return c(/^[a-zA-Z0-9]{4,20}$/i.test(a)),a}},minlength:{message:"最少输入{{min}}个字",get:function(a,b,c){var f,d=b.element,e=parseInt(d.getAttribute("minlength"),10);return isFinite(e)||(e=parseInt(d.getAttribute("data-duplex-minlength"),10)),f=b.data.min=e,a&&a.length?c(a.length>=f):c(!0),a}},maxlength:{message:"最多输入{{max}}个字",get:function(a,b,c){var f,d=b.element,e=parseInt(d.getAttribute("maxlength"),10);return isFinite(e)||(e=parseInt(d.getAttribute("data-duplex-maxlength"),10)),f=b.data.max=e,a&&a.length?c(a.length<=f):c(!0),a}},gt:{message:"必须大于{{max}}",get:function(a,b,c){var f,d=b.element,e=parseInt(d.getAttribute("max"),10);return isFinite(e)||(e=parseInt(d.getAttribute("data-duplex-gt"),10)),f=b.data.max=e,c(parseFloat(a)>f),a}},lt:{message:"必须小于{{min}}",get:function(a,b,c){var f,d=b.element,e=parseInt(d.getAttribute("min"),10);return isFinite(e)||(e=parseInt(d.getAttribute("data-duplex-lt"),10)),f=b.data.min=e,c(parseFloat(a)<f),a}},eq:{message:"必须等于{{eq}}",get:function(a,b,c){var d=b.element,e=parseInt(d.getAttribute("data-duplex-eq"),10),f=b.data.eq=e;return c(parseFloat(a)==f),a}},contains:{message:"必须包含{{array}}中的一个",get:function(a,b,c){var f,g,h,i,d=[].concat(a).map(String),e=(b.element.getAttribute("data-duplex-contains")||"").split(",");for(b.data.array=e,f=!1,g=0,h=d.length;h>g;g++)if(i=d[g],e.indexOf(i)>=0){f=!0;break}return c(f),a}},contain:{message:"必须包含{{array}}",get:function(a,b,c){var f,g,h,i,d=[].concat(a).map(String),e=(b.element.getAttribute("data-duplex-contain")||"").split(",");if(b.data.array=e.join("与"),d.length){for(f=!0,g=0,h=e.length;h>g;g++)if(i=e[g],-1===d.indexOf(i)){f=!1;break}}else f=!1;return c(f),a}},pattern:{message:"必须匹配/{{pattern}}/这样的格式",get:function(a,b,c){var d=b.element,e=d.getAttribute("pattern"),f=d.getAttribute("data-duplex-pattern"),g=b.data.pattern=e||f,h=new RegExp("^(?:"+g+")$");return c(h.test(a)),a}}}),h=avalon.ui.validation=function(a,b,c){var e,d=b.validationOptions,f=avalon.define(b.validationId,function(b){avalon.mix(b,d),b.$skipArray=["widgetElement","data","validationHooks","validateInKeyup","validateAllInSubmit","resetInBlur"],b.widgetElement=a,b.data=[],b.$init=function(){a.setAttribute("novalidate","novalidate"),avalon.scan(a,[f].concat(c)),b.validateAllInSubmit&&(e=avalon.bind(a,"submit",function(a){a.preventDefault(),b.validateAll(b.onValidateAll)})),"function"==typeof d.onInit&&d.onInit.call(a,f,d,c)},b.$destory=function(){b.data=[],e&&avalon.unbind(a,"submit",e),a.textContent=a.innerHTML=""},b.validateAll=function(a){var c="function"==typeof a?a:b.onValidateAll,d=b.data.filter(function(a){var b=a.element;return b&&!b.disabled&&f.widgetElement.contains(b)}).map(function(a){return b.validate(a,!0)});Promise.all(d).then(function(a){var f,e,g,d=[];for(e=0;f=a[e++];)d=d.concat(f);b.deduplicateInValidateAll&&(g={},d=d.filter(function(a){var b=a.element,c=b.getAttribute("data-validation-id");return c||(c=setTimeout("1"),b.setAttribute("data-validation-id",c)),g[c]?!1:(g[c]=!0,!0)})),c.call(b.widgetElement,d)})},b.resetAll=function(a){b.data.filter(function(a){return a.element}).forEach(function(a){try{b.onReset.call(a.element,{type:"reset"},a)}catch(c){}});var c="function"==typeof a?a:b.onResetAll;c.call(b.widgetElement)},b.validate=function(a,c,d){var l,e=a.valueAccessor(),g=f.validationHooks,h=avalon.duplexHooks,i=[],k=a.element;return null===e&&(e=""),a.validateParam.replace(/\w+/g,function(b){var d,f,l,c=g[b]||h[b];k.disabled||(i.push(new Promise(function(a,b){d=a,f=b})),l=function(f){if(a.norequired&&""===e&&(f=!0),f)d(!0);else{var g={element:k,data:a.data,message:k.getAttribute("data-duplex-"+b+"-message")||k.getAttribute("data-duplex-message")||c.message,validateRule:b,getMessage:j};d(g)}},a.data={},c.get(e,a,l))}),l=Promise.all(i).then(function(a){var g,f,e=[];for(f=0;g=a[f++];)"object"==typeof g&&e.push(g);return c||(e.length?b.onError.call(k,e,d):b.onSuccess.call(k,e,d),b.onComplete.call(k,e,d)),e})},b.$watch("avalon-ms-duplex-init",function(c){var e,h,i,j,d=f.validationHooks;switch(c.valueAccessor=c.evaluator.apply(null,c.args),avalon.type(c.valueAccessor())){case"array":c.valueResetor=function(){this.valueAccessor([])};break;case"boolean":c.valueResetor=function(){this.valueAccessor(!1)};break;case"number":c.valueResetor=function(){this.valueAccessor(0)};break;default:c.valueResetor=function(){this.valueAccessor("")}}return e=avalon.duplexHooks,"function"!=typeof c.pipe&&avalon.contains(a,c.element)?(h=[],i=[],c.param.replace(/\w+/g,function(a){var b=d[a]||e[a];b&&"function"==typeof b.get&&b.message?i.push(a):h.push(a),"norequired"===a&&(c.norequired=!0)}),c.validate=b.validate,c.param=h.join("-"),c.validateParam=i.join("-"),i.length&&(b.validateInKeyup&&c.bound("keyup",function(a){var e,d=c.element&&c.element.getAttribute("data-duplex-event");(!d||/^(?:key|mouse|click|input)/.test(d))&&(e=g(a),setTimeout(function(){b.validate(c,0,e)}))}),b.validateInBlur&&c.bound("blur",function(a){b.validate(c,0,g(a))}),b.resetInFocus&&c.bound("focus",function(a){b.onReset.call(c.element,g(a),c)}),j=b.data.filter(function(a){return a.element}),avalon.Array.ensure(j,c),b.data=j),!1):void 0})});return f},i=/\\?{{([^{}]+)\}}/gm,h.defaults={validationHooks:{},onSuccess:avalon.noop,onError:avalon.noop,onComplete:avalon.noop,onValidateAll:avalon.noop,onReset:avalon.noop,onResetAll:avalon.noop,validateInBlur:!0,validateInKeyup:!0,validateAllInSubmit:!0,resetInFocus:!0,deduplicateInValidateAll:!1}}();